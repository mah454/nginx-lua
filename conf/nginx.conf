worker_processes  1;

events {
    worker_connections  1024;
}

http {
    lua_package_path "/usr/local/openresty/nginx/lua/?.lua;;";

    # Shared cache for JWT public keys or other data
    lua_shared_dict jwt_keys 10m;

    server {
        listen 80;

        # Auth-protected route
        location /api/ {
            access_by_lua_file /usr/local/openresty/nginx/lua/auth.lua;
            proxy_pass http://backend;
        }

        # A public health endpoint (no auth)
        location /health {
            default_type text/plain;
            return 200 'OK';
        }
    }

    # Backend upstream (could be another container/service)
    upstream backend {
        server host.containers.internal:9000;  # Podman host service
    }
}

